\section{Theory}
\label{theory}

Over the years a variety of techniques have been developed to calculate fluid dynamics. In this research a momentum balance called the \emph{Navier-Stokes} equations are used. These equations and their derivatives will be explained in this section, as well as general CFD theory. 

\subsection{Navier-Stokes}

The Navier-Stokes equations describe the balance of forces acting at any given region of a fluid. This set of equations is used for computing the flow of a fluid, such as environmental flow. In the case of an incompressible fluid, which air can be approximated as at low wind speeds\cite{fundaero}, the Navier-Stokes equations can be simplified as:
\begin{equation}\label{eq:NS}
\rho \left( \frac{\partial u_i}{\partial t} + u_j \frac{\partial u_i}{\partial x_j} \right) = -\frac{\partial p}{\partial x_i} + \mu \frac{\partial^2 u_i}{\partial x_j \partial x_j} + f_i. 
\end{equation} 
In this equation $\rho$ is the (constant) fluid density, $u_i$ is the speed of the fluid in the $x_i$ direction, $p$ is the pressure, $\mu$ is the viscosity and $f_i$ is force per volume. The left hand side of this equation is the change of momentum of the fluid, where the first term is the rate of change in time, and the second term is the steady acceleration over position. The right hand side of the equation are the forces driving the change of momentum, where the first term is the pressure gradient, the second term is momentum transport due to viscosity, and the third term are other body forces such as a gravity or electromagnetic field.

There is no analytic solution for these equations governing turbulent flow, so the solutions must be found using numeric calculations on a computer. However, it would not be viable to attempt this calculation down to the smallest scale for a large scale airflow such as the flow around a building. The amount of control volumes and computational power needed would mean that it would take years to complete with even the most potent supercomputers. 

The question arises whether it is really needed to compute the physics down to the smallest level. Where each single small vortex is at each moment is generally not relevant information. The macroscopic effects of turbulent flow is usually what interests the engineer. Since only the macroscopic effects of all tiny turbulent phenomena are of interest, these effects can be modeled instead of computed to greatly reduce the computational power needed. 

\subsection{Reynolds Averaged Navier Stokes (RANS)}
A common way to simplify the turbulent flow calculations is by separating the mean value and a fluctuating value of the solution. Separating a quantity $u$ in this way is called \emph{Reynold decomposition}, and can be written as:
\begin{equation}\label{eq:RD}
u(x,y,z,t) = \overline{u(x,y,z)}+u'(x,y,z,t).
\end{equation}
Note that the mean value is not dependent on time. Averaging the fluctuating value over time will return 0; since the mean value of $u$ is already captured in $\bar{u}$, the fluctuating part necessarily fluctuates around 0. By substituting \autoref{eq:RD} in \autoref{eq:NS} and averaging the equation, the time-independent \emph{Reynolds averaged Navier-Stokes} (RANS) equations are derived:
\begin{equation}\label{eq:RANS}
\rho \bar{u}_j \frac{\partial \bar{u}_i}{\partial x_j} = -\frac{\partial}{\partial x_i} \left[ \bar{p} + \mu \frac{\partial \bar{u}_i}{\partial x_j} + \frac{\partial \bar{u}_j}{\partial x_i} - \rho \overline{u_i'u_j'}\right] + f_i. 
\end{equation} 
The solution of these equations consists of the mean kinetic energy (flow) and a term indicating the mean turbulent kinetic energy. Since the effects of turbulence are now averaged, it is possible to use a coarser mesh. It is no longer needed to compute turbulence down to the smallest scale. 

\subsection{The closure problem}
When evaluating \autoref{eq:RANS}, the term $\overline{u_i'u_j'}$ governing the turbulent energy is still an unknown. At this point there are three equations, but aside from the three speed variables $u_i$, another unknown term $\overline{u_i'u_j'}$ is introduced. Using the \emph{eddy viscosity model} (EVM), this term can be modeled according to:
\begin{equation}\label{eq:EVM}
-\overline{u_i'u_j'}=\nu_t\left(\frac{\partial \bar{u}_i}{\partial x_j} + \frac{\partial \bar{u}_j}{\partial x_i} \right) - \frac{2}{3}k,
\end{equation}
where $\nu_t$ is the turbulent viscosity, and $k$ is the turbulent kinetic energy:
\begin{equation}\label{eq:k}
k = \frac{1}{2}\overline{u'_iu'_i}.
\end{equation}

Since the turbulent transfer of momentum by eddies creates internal fluid friction, $\nu_t$ can be thought of as a boost in the viscosity of the fluid. However, $\nu_t$ is not a fluid property, but is dependent on the state of turbulence and must be determined by the turbulence model. It can be defined as 
\begin{equation}\label{eq:NU}
\nu_t = C_\mu\frac{k^2}{\epsilon},
\end{equation}
where $C_\mu$ is a constant, and $\epsilon$ is the dissipation of turbulent energy. The equations governing the properties $k$ and $\epsilon$ are:
\begin{equation}\label{eq:ke1}
\frac{\partial k}{\partial t} + \bar{u}_j\frac{\partial k}{\partial x_j} = \frac{\partial}{\partial x_j} \left[(\nu + \nu_t) \frac{\partial k }{\partial x_j}\right] + P_k - \epsilon;
\end{equation}
\begin{equation}\label{eq:ke2}
\frac{\partial \epsilon}{\partial t} + \bar{u}_j\frac{\partial \epsilon}{\partial x_j} = \frac{\partial}{\partial x_j} \left[(\nu + \nu_t) \frac{\partial \epsilon}{\partial x_j}\right] + \frac{\epsilon}{k}(C_{\epsilon 1}P_k - C_{\epsilon 2}\epsilon).
\end{equation}
In these equations, $P_k$ is the production of turbulent kinetic energy and $C_{\epsilon 1}$ and $C_{\epsilon 2}$ are model coefficients. $P_k$ is luckily not another variable that has to be modeled, and is defined as:
\begin{equation}\label{eq:P}
P_k=-\overline{u'_iu'_i}\frac{\partial \bar{u}_i}{\partial x_j}
\end{equation}
At this point we have a system of five equations with five unknowns, so it is possible to compute the solution.

\subsection{Finite volume method}

The control volume is discretized into finite volume cells into a grid called the \emph{mesh}. In each of these cells the average intensive properties are computed. When directly computing the Navier-Stokes equations, the mesh should be fine enough that these properties are approximately constant over the control volume. When using RANS, this is no longer needed, since the turbulence is averaged and the macroscopic effect of the turbulence are taken into account by use of the turbulent viscosity. Still, a good balance should be found between higher accuracy with a high cell density, and a higher computation speed with lower cell density. 

With every computational step the new values in the equation are computed. The difference between two consecutively computed values, divided by the mean value is called the \emph{residual}. On the long term the residual should become smaller until the calculation converges to the solution. The CFD is usually stopped when the residual drops below a certain value. This dictates the accuracy of your outcome, but also how many iterations have to be done to converge to this value.